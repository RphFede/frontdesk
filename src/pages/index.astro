---
const { title } = Astro.props;
import '../styles/app.styl';
import Navigation from '../components/Navigation.astro';
import Dashboard from '../views/Dashboard.astro';
import Invoices from '../views/Invoices.astro';
import Suppliers from '../views/Suppliers.astro';
import Export from '../views/Export.astro';
import Settings from '../views/Settings.astro';
---

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title}</title>
  <meta name="theme-color" content="#2a2a2a">
</head>
<body>
  <div class="app-container">
    <header>
      <h1>Sistema de Gestión de Facturas</h1>
      <div class="user-info">
        👤 Usuario: Admin | 🕒 Última sesión: Hoy 14:30
      </div>
    </header>
    
    <div class="main-layout">
      <aside class="sidebar">
        <nav>
          <Navigation />
        </nav>
      </aside>
      
      <main class="content">
        <section id="dashboard-view" class="view active">
          <Dashboard />
        </section>
        
        <section id="invoices-view" class="view">
          <Invoices />
        </section>
        
        <section id="suppliers-view" class="view">
          <Suppliers />
        </section>
        
        <section id="export-view" class="view">
          <Export />
        </section>
        
        <section id="settings-view" class="view">
          <Settings />
        </section>
      </main>
    </div>
    
    <footer>
      <p>© 2023 FrontDesk. Todos los derechos reservados.</p>
    </footer>
  </div>
</body>

<script>
  class SPANavigator {
    constructor() {
      this.currentView = 'dashboard';
      this.views = new Map();
      this.initViews();
      this.initNavigation();
    }

    initViews() {
      const viewElements = document.querySelectorAll('.view');
      viewElements.forEach(view => {
        const viewId = view.id.replace('-view', '');
        this.views.set(viewId, view);
      });
    }

    initNavigation() {
      const navButtons = document.querySelectorAll('nav button');
      
      navButtons.forEach(button => {
        button.addEventListener('click', (e) => {
          const targetView = e.target.dataset.target;
          if (targetView) {
            this.navigateTo(targetView);
          }
        });
      });
    }

    navigateTo(viewName) {
      if (!this.views.has(viewName)) {
        console.error(`Vista '${viewName}' no encontrada`);
        return;
      }

      // Ocultar vista actual
      if (this.views.has(this.currentView)) {
        this.views.get(this.currentView).classList.remove('active');
      }

      // Mostrar nueva vista
      this.views.get(viewName).classList.add('active');
      this.updateActiveNav(viewName);
      this.currentView = viewName;
      this.onViewChange(viewName);
    }

    updateActiveNav(activeView) {
      const navButtons = document.querySelectorAll('nav button');
      navButtons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.target === activeView) {
          btn.classList.add('active');
        }
      });
    }

    onViewChange(viewName) {
      switch(viewName) {
        case 'invoices':
          this.initInvoicesFeatures();
          break;
        case 'suppliers':
          this.initSuppliersFeatures();
          break;
        case 'export':
          this.initExportFeatures();
          break;
        case 'settings':
          this.initSettingsFeatures();
          break;
      }
    }

    initInvoicesFeatures() {
      const searchBox = document.querySelector('#invoices-view input[type="text"]');
      if (searchBox && !searchBox.hasAttribute('data-initialized')) {
        searchBox.addEventListener('input', (e) => {
          this.filterInvoices(e.target.value);
        });
        searchBox.setAttribute('data-initialized', 'true');
      }
    }

    initSuppliersFeatures() {
      const searchBox = document.querySelector('#suppliers-view input[type="text"]');
      if (searchBox && !searchBox.hasAttribute('data-initialized')) {
        searchBox.addEventListener('input', (e) => {
          this.filterSuppliers(e.target.value);
        });
        searchBox.setAttribute('data-initialized', 'true');
      }
    }

    initExportFeatures() {
      // Inicializar funcionalidades de exportación
      console.log('Funcionalidades de exportación inicializadas');
    }

    initSettingsFeatures() {
      // Inicializar funcionalidades de configuración
      console.log('Funcionalidades de configuración inicializadas');
    }

    filterInvoices(searchTerm) {
      const tableRows = document.querySelectorAll('#invoices-view table tbody tr');
      tableRows.forEach(row => {
        const text = row.textContent?.toLowerCase() || '';
        row.style.display = text.includes(searchTerm.toLowerCase()) ? '' : 'none';
      });
    }

    filterSuppliers(searchTerm) {
      const tableRows = document.querySelectorAll('#suppliers-view table tbody tr');
      tableRows.forEach(row => {
        const text = row.textContent?.toLowerCase() || '';
        row.style.display = text.includes(searchTerm.toLowerCase()) ? '' : 'none';
      });
    }
  }

  // Inicializar cuando el DOM esté listo
  document.addEventListener('DOMContentLoaded', () => {
    try {
      window.spaNavigator = new SPANavigator();
      console.log('SPA Navigator inicializado correctamente');
    } catch (error) {
      console.error('Error al inicializar SPA Navigator:', error);
    }
  });
</script>
</html>


<style lang="stylus">
  .app-container
    display flex
    flex-direction column
    height 100vh
    width 100%
    
  header
    padding 1rem 2rem
    background var(--bg-card)
    border-bottom 1px solid var(--border-color)
    display flex
    justify-content space-between
    align-items center
    flex-shrink 0
    z-index 10
    
    .user-info
      color var(--text-secondary)
      font-size 0.9rem
  
  .main-layout
    display flex
    flex 1
    height calc(100vh - 140px) // Resta la altura del header y footer
    
  .sidebar
    background var(--bg-secondary)
    width 250px
    flex-shrink 0
    border-right 1px solid var(--border-color)
    overflow-y auto
    
    @media (max-width: 768px)
      width 200px
      
    @media (max-width: 640px)
      display none
    
  .content
    flex 1
    padding 2rem
    overflow-y auto
    background var(--bg-primary)
    
  .view
    display none
    
    &.active
      display block
      animation fadeIn 0.3s ease-in-out
  
  footer
    padding 1rem 2rem
    background var(--bg-card)
    border-top 1px solid var(--border-color)
    text-align center
    color var(--text-secondary)
    font-size 0.8rem
    flex-shrink 0
  
  @keyframes fadeIn
    from
      opacity 0
      transform translateY(10px)
    to
      opacity 1
      transform translateY(0)
</style>